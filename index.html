<!doctype html>
<html lang="en">

<head>
  <title>SGCI Shipping Calendar</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href='fullcalendar/core/main.css' rel='stylesheet' />
    <link href='fullcalendar/daygrid/main.css' rel='stylesheet' />
    <link href='fullcalendar/timegrid/main.css' rel='stylesheet' />

    <script src='fullcalendar/core/main.js'></script>
    <script src='fullcalendar/daygrid/main.js'></script>
	<script src='fullcalendar/timegrid/main.js'></script>
    <script src='fullcalendar/interaction/main.js'></script>
 
  <!--PRIMARY CALENDAR & EVENT MANAGEMENT SCRIPT--> 		  
  <script>  	

  		var _DEBUG = false;
  		var curMinute;
  		var curHour;
  		var curDay;
  		var curMonth;
  		var curYear;
      	document.addEventListener('DOMContentLoaded', function() {
	        var calendarEl = document.getElementById('calendar');

	        var calendar = new FullCalendar.Calendar(calendarEl, {
	        	plugins: [ 'dayGrid', 'timeGrid', 'interaction' ],
	            defaultView: 'dayGridWeek',
	          	selectable: false,
	          	header: {
	      			left: 'prev,next, today',
	     			center: 'title',
	      			right: 'timeGridDay, timeGridWeek, dayGridMonth'
	    		},
	        	dateClick: function(info) {
	        		curDay = info.date.getDate();
	    			curMonth = info.date.getMonth() + 1;
		    		curYear = info.date.getFullYear();
		          	//display new shipment form
		    		$("#formcontainer").slideDown(0); 

		    		$("#dateAlert").html(`${curMonth}/${curDay}/${curYear}`);
		    		window.scrollTo({
		    			top: 1000,
		    			behavior: 'smooth',
		    		});
		    		curDay = info.date.getDate();
		    		curMonth = info.date.getMonth() + 1;
		    		curYear = info.date.getFullYear();
	    		
	            
	    		}
	        

	        });
	       	calendar.render();
	       	/*
 			* Schedule truck: collect form data, wrap into event obj, and place it in the calendar and hide the form.
 			*/
 			$("#submitTruckBtn").click(function() {
	 	  		//unwrapping data...
			 	var startTime = $("#startTime").val();
			 	var endTime = $("#endTime").val();
			 	//FIXME DIFFERENTIATE BETWEEN INVALID AND ALL DAY EVENTS
			 	console.log("here: " + startTime + ".");
			 	var allDay = (startTime === "");
			 	var startHour;
			 	var startMinute;
			 	var endHour;
			 	var endMinute;
			 	var isOutgoing = ($("#outgoingbtn").attr("class") === "btn btn-primary");
			 	console.log(`Outgoing: ${isOutgoing}`);
			 	if (!allDay) { 
			 		startHour = startTime.split(":")[0];
			 		startMinute = startTime.split(":")[1];
			 		endHour = endTime.split(":")[0];
			 		endMinute = endTime.split(":")[1];
			 	}
			 	var date = $("#dateAlert").html();
			 	var customerName = $("#customerBox").val();
				var vendorName = $("#vendorBox").val();
			 	var destination = $("#destinationBox").val();
			 	if (_DEBUG) {
				 	console.log(startTime);
				 	console.log(endTime);
				 	console.log(date);
				 	console.log(customerName);
				 	console.log(`vendorName: ${vendorName}`);
				 	console.log(destination);
			 	}

			 	//packing data into object
			 	var newEvent;
				if (!allDay) {
					newEvent = {
			              title: vendorName,
			              start: new Date (curYear,curMonth - 1, curDay, startHour, startMinute),
			              end: new Date (curYear, curMonth - 1, curDay, endHour, endMinute),
			              allDay: allDay,
			              editable: false,
			              backgroundColor: (isOutgoing ?  '#1a75ff' : '#EF2E2E')

				    };
				} else {
					newEvent = {
						title: vendorName,
						start: new Date(curYear, curMonth - 1, curDay),
						allDay: allDay,
						editable: true,
						backgroundColor: (isOutgoing ?  '#1a75ff' : '#EF2E2E')
					};
				}
			 	//insert new object into calendar as event 
			 	calendar.addEvent(newEvent);
			 	//hide form
			 	$("#formcontainer").slideUp(300);
			 	//scroll to top
			 	window.scrollTo({
			 		top: 0,
			 		behavior: 'smooth'
			 	});
			 });
   		});     



      

    </script>
</head>

<body>
<div class ="container">
	<p id = "demo">Not working</p>
	<br>
	<h2 id = "instructions">Click a date to schedule a truck. Click an event to view/edit its information.</h2>

	<!--
	<div class="col-lg-12">
	  <div id="panel1" class="panel panel-primary">
		  <div class="panel-heading">#panel1</div>
		  <div class="panel-body"> Content! </div>
	  </div>
	</div>  
	  <div class="col-xs-3">
	  <div id="panel2" class="panel panel-primary">
	  <div class="panel-heading">
	   #panel2
	  </div>
	  <div class="panel-body"> Content?</div>
	</div>
</div>
-->
	<div id = "calendar"> </div>
	</div>
<div class = "container" id = "formcontainer">
	<div id = "dateAlert" class="alert alert-primary" role="alert">
	If you see this, tell Spencer!
	</div>
		<form>
            <div class="form-group">
			 <div class="btn-group" role="group" aria-label="Basic example">
 				 <button type="button" class="btn btn-primary" id = "outgoingbtn">Outgoing Shipment</button> 
  				 <button type="button" class="btn btn-outline-primary" id = "incomingbtn">Incoming Delivery</button>
			 </div>
			</div>
		  <!-- -->
		  <div class = "form-group">
		  	<label for="appt">Delivery Window:</label>
			<input type="time" id="startTime" name="startTime" min= "06:30" max = "23:00" aria-describedby="timeHelpBlock">
			<input type="time" id="endTime" name="endTime"  min= "06:30" max = "23:00" aria-describedby="timeHelpBlock">
			<button type="button" class="btn btn-danger" id = "clearTimeBtn">Reset</button>
			<small id="timeHelpBlock" class="form-text text-muted">Leave blank if there is no specified time.</small>
			
		  </div>
		  <div class="form-group">
		    <label for="vendorBox">Vendor</label>
		    <input type="text" class="form-control" id="vendorBox" placeholder="Vendor Name">
		  </div>
		  <div class="form-group">
		    <label for="customerBox">Customer</label>
		    <input type="text" class="form-control" id="customerBox" placeholder="Customer Name">
		  </div>
		  <div class="form-group">
		    <label for="destinationBox">Destination</label>
		    <input type="text" class="form-control" id="destinationBox" placeholder="123 Easy St, Whitestown, IN 46075">
		  </div>
		  <!-- -->
		  <!-- -->
		  <div class="form-group">
		    <label for="freightList">Freight List</label>
		    <select multiple class="form-control" id="freightList">
		      <option>No freight yet.</option>
		    </select>
		  </div>
		  <!-- -->
		  <div class="form-group">
		    <label for="notesArea">Comments/Notes</label>
		    <textarea class="form-control" id="notesArea" rows="3"></textarea>
		  </div>
		  <!--SHIP TICKET FILE SELECTION-->
		  <div class="form-group">
    		<label for="shipTicketFileArea">Ship Ticket</label>
    		<input type="file" class="form-control-file" id="shipTicketFileArea">
  		  </div>
  		  <!--END FILE SELECTION-->
		  <button type="button" class="btn btn-primary" id = "submitTruckBtn">Schedule Truck</button>
		</form>
		<script>

		</script>
	</div>


<script src="js/scripts.js"></script>

</body>

</html>
