<!doctype html>
<html lang="en">

<head>
  <title>SGCI Shipping Calendar</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
  <script>console.log(window.Popper); </script>
  <script src = "https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src = "https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js"></script>
  
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href='fullcalendar/core/main.css' rel='stylesheet' />
    <link href='fullcalendar/daygrid/main.css' rel='stylesheet' />
    <link href='fullcalendar/timegrid/main.css' rel='stylesheet' />

    <script src='fullcalendar/core/main.js'></script>
    <script src='fullcalendar/daygrid/main.js'></script>
	<script src='fullcalendar/timegrid/main.js'></script>
    <script src='fullcalendar/interaction/main.js'></script>
	
  <!--PRIMARY CALENDAR & EVENT MANAGEMENT SCRIPT--> 		  
  <script>  	

  		var _DEBUG = false;
  		var curMinute;
  		var curHour;
  		var curDay;
  		var curMonth;
  		var curYear;
      	document.addEventListener('DOMContentLoaded', function() {
	        var calendarEl = document.getElementById('calendar');

	        var calendar = new FullCalendar.Calendar(calendarEl, {
	        	weekends: false,
	        	plugins: [ 'dayGrid', 'timeGrid', 'interaction' ],
	            defaultView: 'timeGridWeek',
	          	selectable: false,
	          	header: {
	      			left: 'prev,next, today',
	     			center: 'title',
	      			right: 'timeGridDay, timeGridWeek, dayGridMonth'
	    		},
	    		//Date clicking handling 
	        	dateClick: function(info) {
	        		curDay = info.date.getDate();
	    			curMonth = info.date.getMonth() + 1;
		    		curYear = info.date.getFullYear();
		          	//display new shipment form
		    		$("#formcontainer").slideDown(0); 

		    		$("#dateAlert").html(`Selected Date: <b>${curMonth}/${curDay}/${curYear}</b>`);
		    		info.dayEl.style.backgroundColor = '#4287f5';

		    		setTimeout(function() {info.dayEl.style.backgroundColor = 'white';}, 100);
		    		window.scrollTo({
		    			top: 2000,
		    			behavior: 'smooth',
		    		});
		    		curDay = info.date.getDate();
		    		curMonth = info.date.getMonth() + 1;
		    		curYear = info.date.getFullYear();	            
	    		}, //end dateClick
	    		eventClick: function(info) {
	    			var time = (info.event.allDay) ? "" : `${info.event.extendedProps.eventStartTime}-${info.event.extendedProps.eventEndTime}`;
	    			console.log($("#eventTitle").html(info.event.title));
	    			$("#eventData").html(`<b>Date:</b> ${info.event.extendedProps.eventDate}<br><b>Delivery Window:</b> <br><b>Customer Name:</b> ${info.event.extendedProps.customerName}<br><b>Destination:</b> ${info.event.extendedProps.destination}<br>`)
	    			PDFObject.embed(info.event.extendedProps.shipTicketURL, "#pdfContainer");
	    			$("#myModal").modal("show");
	    			
	    			//PDFObject.embed("pdf/sample-3pp.pdf", "#pdfContainer");
	    			
	            }
	        
	        });
	       	calendar.render();
	       	/*
 			* Schedule truck: collect form data, wrap into event obj, and place it in the calendar and hide the form.
 			*/
 			$("#submitTruckBtn").click(function() {
	 	  		//unwrapping data...
			 	var startTime = $("#startTime").val();
			 	var endTime = $("#endTime").val();
			 	//FIXME DIFFERENTIATE BETWEEN INVALID AND ALL DAY EVENTS
			 	console.log("here: " + startTime + ".");
			 	var allDay = (startTime === "");
			 	var startHour;
			 	var startMinute;
			 	var endHour;
			 	var endMinute;
			 	var isOutgoing = ($("#outgoingbtn").attr("class") === "btn btn-primary");
			 	var bkgColor = (isOutgoing ?  '#1a75ff' : '#EF2E2E');
			 	console.log(`Outgoing: ${isOutgoing}`);
			 	if (!allDay) { 
			 		startHour = startTime.split(":")[0];
			 		startMinute = startTime.split(":")[1];
			 		endHour = endTime.split(":")[0];
			 		endMinute = endTime.split(":")[1];
			 	}
			 	var date = $("#dateAlert").text().split(":")[1];
			 	var customerName = $("#customerBox").val();
				var vendorName = $("#vendorBox").val();
			 	var destination = $("#destinationBox").val();
			 	if (_DEBUG) {
				 	console.log(startTime);
				 	console.log(endTime);
				 	console.log(date);
				 	console.log(customerName);
				 	console.log(`vendorName: ${vendorName}`);
				 	console.log(destination);
			 	}

			 	//packing data into object
			 	var newEvent;
				if (!allDay) {
					console.log("file is " + $("#shipTicketFileArea").val())
					newEvent = {
			              title: vendorName,
			              start: new Date (curYear,curMonth - 1, curDay, startHour, startMinute),
			              end: new Date (curYear, curMonth - 1, curDay, endHour, endMinute),
			              allDay: allDay,
			              editable: false,
			              backgroundColor: bkgColor,
			              displayEventEnd: true,
			              customerName: customerName,
			              eventDate: date,
			              destination: destination,
			              eventStartTime: startTime,
			              eventEndTime: endTime,
			              shipTicketURL: URL.createObjectURL(document.getElementById('shipTicketFileArea').files[0])

			              

				    };
				} else {
					console.log("file is " + $("#shipTicketFileArea").val());
					newEvent = {
						title: vendorName,
						start: new Date(curYear, curMonth - 1, curDay),
						allDay: allDay,
						editable: false,
						backgroundColor: bkgColor,
						displayEventEnd: true,
						customerName: customerName,
			            eventDate: date,
			            destination: destination,
			            eventStartTime: startTime,
			            eventEndTime: endTime,
			            shipTicketURL: URL.createObjectURL(document.getElementById('shipTicketFileArea').files[0])
						
					};
				}
			 	//insert new object into calendar as event 
			 	calendar.addEvent(newEvent);
			 	//hide form
			 	$("#formcontainer").slideUp(300);
			 	//scroll to top
			 	window.scrollTo({
			 		top: 0,
			 		behavior: 'smooth'
			 	});
			 });
   		});     



      

    </script>
</head>

<body>
<!-- EVENT DATA MODAL -->
<div class="modal" tabindex="-1" role="dialog" id= "myModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="eventData">If you're seeing this, something went wrong! Take note of what happened and let Spencer know.</p>
        <div class = "row"><b id="modalDate"></b>Date:</div>
        <div class = "row"><b id="modalTime"></b>Arrival Window</div>
        <div class = "row"><b id="modalCustomer"></b></div>
        <div class = "row"><b id="modalDestinaion"></b></div>
        <div class = "row"><b id="modalComments">Comments/Notes:</b></div>
        <div class = "row"><b id="modalComments">Comments/Notes:</b></div>
        <div id = "pdfContainer"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Edit</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!--END MODAL-->
<div class ="container">
	<p id = "demo">Not working</p>
	<br>
	<h2 id = "instructions">Click a date to schedule a truck. Click an event to view/edit its information.</h2>

	<!--
	<div class="col-lg-12">
	  <div id="panel1" class="panel panel-primary">
		  <div class="panel-heading">#panel1</div>
		  <div class="panel-body"> Content! </div>
	  </div>
	</div>  
	  <div class="col-xs-3">
	  <div id="panel2" class="panel panel-primary">
	  <div class="panel-heading">
	   #panel2
	  </div>
	  <div class="panel-body"> Content?</div>
	</div>
</div>
-->
	<div id = "calendar"> </div>
	</div>
<div class = "container" id = "formcontainer">
	<div id = "dateAlert" class="alert alert-primary" role="alert">
	If you see this, tell Spencer!
	</div>
		<form>
            <div class="form-group">
			 <div class="btn-group" role="group" aria-label="Basic example">
 				 <button type="button" class="btn btn-primary" id = "outgoingbtn">Outgoing Shipment</button> 
  				 <button type="button" class="btn btn-outline-primary" id = "incomingbtn">Incoming Delivery</button>
			 </div>
			</div>
		  <!-- -->
		  <div class = "form-group">
		  	<label for="appt">Arrival Window:</label>
			<input type="time" id="startTime" name="startTime" min= "06:30" max = "23:00" aria-describedby="timeHelpBlock">
			<input type="time" id="endTime" name="endTime"  min= "06:30" max = "23:00" aria-describedby="timeHelpBlock">
			<button type="button" class="btn btn-danger" id = "clearTimeBtn">Reset</button>
			<small id="timeHelpBlock" class="form-text text-muted">Leave blank if there is no specified time.</small>
			
		  </div>
		  <div class="form-group">
		    <label for="vendorBox">Vendor</label>
		    <input type="text" class="form-control" id="vendorBox" placeholder="Vendor Name">
		  </div>
		  <div class="form-group">
		    <label for="customerBox">Customer</label>
		    <input type="text" class="form-control" id="customerBox" placeholder="Customer Name">
		  </div>
		  <div class="form-group">
		    <label for="destinationBox">Destination</label>
		    <input type="text" class="form-control" id="destinationBox" placeholder="123 Easy St, Whitestown, IN 46075">
		  </div>
		  <!-- -->
		  <!--SHIP TICKET FILE SELECTION-->
		  <div class="form-group">
    		<label for="shipTicketFileArea">Ship Ticket</label>
    		<script>
    		var loadFile = function(event) {
					uploadedFile = URL.createObjectURL(event.target.files[0]);
					//PDFObject.embed(uploadedFile, "#pdfContainer");
					};
			</script>
    		<input type="file" class="form-control-file" id="shipTicketFileArea" onchange="loadFile(event)">

  		  </div>
  		  <!--END FILE SELECTION-->
		  <!--FREIGHT CHARTER-->
		  <div class="form-group">
		    <label for="freightList">Freight List</label>
		    <select multiple class="form-control" id="freightList">
		      <option>No freight yet.</option>
		    </select>
		    <button type="button" class="btn btn-warning" id="freightManageBtn">Manage Freight</button>
		  </div>
		  <!--FREIGHT MANAGEMENT FORM-->
		  <div class = "container" id = "freightContainer">
		  		<form >
			<div class="form-group">
			  <div class="row">
			  	<div class="freight-col">
			      Total QTY:
			      <input type = "text" id = "qtyBox">
			    </div>
			    <div class="freight-col">
			      Pallet Count:
			      <input type = "text" id = "palletBox">
			    </div>
			    <div class="freight-col">
			      QTY/Pallet:
			      <input type = "text" id = "palletQtyBox">
			    </div>
			    <div class="freight-col">
			      Net Weight:
			      <input type = "text" id = "weightBox">
			    </div>
			      <button type = "button" class = "btn btn-primary" id = "addNewFreightBtn">Add Freight Item</button>
			    
			  </div>
			</div>
		  		</form>
		  </div>
		  

  		  <!--COMMENTS TEXT AREA-->
		  <div class="form-group">
		    <label for="notesArea">Comments/Notes</label>
		    <textarea class="form-control" id="notesArea" rows="3"></textarea>
		  </div>
  		  
		  <button type="button" class="btn btn-primary" id = "submitTruckBtn">Schedule Truck</button>
		</form>
		<script>

		</script>
	</div>




</body>
<script src="js/scripts.js"></script>
</html>
